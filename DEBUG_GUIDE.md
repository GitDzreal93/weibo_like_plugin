# 🔍 调试指南 - 排查执行问题

## 🚨 问题分析

从你的截图看，主要问题是：
1. **只有一条日志**: "开始执行任务，共1个链接"
2. **没有后续执行**: 任务似乎没有真正开始
3. **链接格式问题**: 输入的链接看起来是编码过的字符串

## 🔧 已添加的调试功能

### 1. **详细错误日志**
- ✅ 添加了 Chrome runtime 错误检测
- ✅ 添加了链接格式验证
- ✅ 添加了标签页创建日志
- ✅ 添加了内容脚本注入日志

### 2. **链接验证增强**
- ✅ URL 格式验证
- ✅ 微博域名检查
- ✅ 无效链接过滤

## 🔍 调试步骤

### 第一步：检查链接格式
**你输入的链接有问题！**

❌ **错误的链接**:
```
1%20Mac%20OS%20X%2010_15_7%29%20AppleWebKit%2F537.36%20%28KHTML,%20like%20Gecko%29%20Chrome%2F137.0.0.0%20Safari%2F537.36%20Edg%2F137.0.0.0
```

✅ **正确的链接格式**:
```
https://weibo.com/5185196272/5176353147060619
```

### 第二步：重新加载扩展
1. 打开 `chrome://extensions/`
2. 找到你的扩展
3. 点击"重新加载"按钮

### 第三步：使用正确的链接测试
1. 清空当前的链接输入框
2. 输入一个有效的微博链接，例如：
   ```
   https://weibo.com/5185196272/5176353147060619
   ```
3. 点击"开始执行"

### 第四步：查看详细日志
现在会显示更详细的日志：
- ✅ "开始执行任务，共X个链接"
- ✅ "开始处理第1个链接: https://..."
- ✅ "成功打开标签页 ID: 123"
- ✅ "内容脚本注入成功"
- ✅ "任务消息已发送到内容脚本"

## 🐛 如果仍有问题，检查以下内容

### 1. **浏览器控制台错误**
按 F12 打开开发者工具，查看：
- **Console 标签**: 查看 JavaScript 错误
- **Network 标签**: 查看网络请求
- **Extensions 标签**: 查看扩展相关错误

### 2. **扩展权限**
确保 manifest.json 中有正确的权限：
```json
{
  "permissions": [
    "tabs",
    "scripting",
    "storage",
    "activeTab"
  ],
  "host_permissions": [
    "https://weibo.com/*",
    "https://m.weibo.cn/*"
  ]
}
```

### 3. **Content Script 问题**
检查 content.js 是否存在并正确配置。

## 🎯 快速测试方案

### 测试用的有效微博链接
```
https://weibo.com/u/1234567890/ABCDEFGHIJK
https://m.weibo.cn/detail/ABCDEFGHIJK
```

### 测试步骤
1. **清空所有内容**
2. **输入有效链接**
3. **设置关键词**: 例如 "测试"
4. **点击开始执行**
5. **观察日志变化**

## 📋 预期的正常日志流程

```
[14:30:15] 开始执行任务，共1个链接
[14:30:15] 开始处理第1个链接: https://weibo.com/...
[14:30:16] 成功打开标签页 ID: 123
[14:30:19] 内容脚本注入成功
[14:30:19] 任务消息已发送到内容脚本
[14:30:21] 当前页面任务完成
[14:30:21] 完成处理第1个链接
[14:30:21] 所有任务执行完成
```

## ⚠️ 常见错误及解决方案

### 错误1: "无效的微博链接格式"
**原因**: 链接格式不正确
**解决**: 使用正确的微博链接格式

### 错误2: "打开标签页失败"
**原因**: 权限不足或链接无效
**解决**: 检查扩展权限和链接有效性

### 错误3: "执行内容脚本失败"
**原因**: content.js 文件缺失或权限问题
**解决**: 确保 content.js 存在且权限正确

### 错误4: "Chrome runtime error"
**原因**: 扩展通信问题
**解决**: 重新加载扩展

## 🔄 重新测试流程

1. **重新加载扩展**
2. **使用正确链接**: `https://weibo.com/5185196272/5176353147060619`
3. **设置关键词**: 例如 "陈昊宇"
4. **点击开始执行**
5. **观察详细日志**

如果按照以上步骤操作，应该能看到详细的执行日志。如果仍有问题，请提供：
- 浏览器控制台的错误信息
- 扩展的详细日志
- 使用的具体链接

这样我就能进一步帮你排查问题！🔍
