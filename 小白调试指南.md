# 🔰 微博控评插件 - 小白调试指南

> 这是一份专门为不会编程的小白准备的详细指南，每一步都有截图说明和详细解释。

## 📋 准备工作清单

在开始之前，请确保你有：
- ✅ Windows/Mac 电脑一台
- ✅ Chrome 浏览器（最新版本）
- ✅ 已下载的项目文件夹
- ✅ 稳定的网络连接

## 🚀 第一步：安装必要软件

### 1.1 安装 Node.js
1. **下载 Node.js**
   - 访问：https://nodejs.org/
   - 点击绿色的 "LTS" 版本下载
   - 选择适合你系统的版本（Windows/Mac）

2. **安装 Node.js**
   - 双击下载的安装包
   - 一路点击"下一步"，使用默认设置
   - 安装完成后重启电脑

3. **验证安装**
   - Windows：按 `Win + R`，输入 `cmd`，按回车
   - Mac：按 `Cmd + 空格`，输入 `终端`，按回车
   - 在黑色窗口中输入：`node --version`
   - 如果显示版本号（如 v18.17.0），说明安装成功

### 1.2 安装 pnpm
1. **在命令行中输入**：
   ```
   npm install -g pnpm
   ```
2. **等待安装完成**（可能需要几分钟）
3. **验证安装**：输入 `pnpm --version`

## 🛠️ 第二步：启动项目

### 2.1 打开项目文件夹
1. **找到项目文件夹**
   - 就是包含 `package.json` 文件的那个文件夹
   - 文件夹名字可能是 `weibo_like_plugin` 或类似名称

2. **在文件夹中打开命令行**
   - **Windows 方法**：
     - 在文件夹空白处按住 `Shift` + 右键
     - 选择"在此处打开 PowerShell 窗口"
   - **Mac 方法**：
     - 打开终端
     - 输入 `cd ` （注意有空格）
     - 把项目文件夹拖到终端窗口
     - 按回车

### 2.2 安装项目依赖
1. **在命令行中输入**：
   ```
   pnpm install
   ```
2. **等待安装完成**
   - 会看到很多文字滚动
   - 最后显示类似 "Done in 30s" 表示完成
   - 如果出现红色错误，请截图求助

### 2.3 启动开发服务器
1. **输入启动命令**：
   ```
   pnpm run dev
   ```
2. **等待启动成功**
   - 看到绿色的 "🟢 DONE" 字样
   - 显示 "Extension re-packaged" 表示成功
   - **重要**：不要关闭这个命令行窗口！

## 🌐 第三步：在浏览器中安装插件

### 3.1 打开 Chrome 扩展管理页面
1. **打开 Chrome 浏览器**
2. **在地址栏输入**：`chrome://extensions/`
3. **按回车键**

### 3.2 启用开发者模式
1. **找到右上角的"开发者模式"开关**
2. **点击开关，确保它是蓝色的（开启状态）**

### 3.3 加载插件
1. **点击"加载已解压的扩展程序"按钮**
2. **选择文件夹**：
   - 进入你的项目文件夹
   - 找到 `build` 文件夹
   - 进入 `chrome-mv3-dev` 文件夹
   - 点击"选择文件夹"
3. **确认安装成功**：
   - 页面上出现你的插件卡片
   - 状态显示为"已启用"

## 🎯 第四步：测试插件功能

### 4.1 查看插件图标
1. **在浏览器工具栏找插件图标**
   - 如果没看到，点击拼图图标（扩展程序图标）
   - 找到"微博控评助手"

### 4.2 打开插件界面
1. **点击插件图标**
2. **应该弹出一个界面**，包含：
   - 关键词输入框
   - 微博链接输入框
   - 各种设置选项
   - "开始执行"按钮

### 4.3 测试基本功能
1. **在关键词框输入**：陈昊宇
2. **在微博链接框输入测试链接**：
   ```
   https://weibo.com/6036398570/5176350752903605
   ```
3. **点击"开始执行"按钮**
4. **观察是否有反应**

## 🔍 第五步：调试和排错

### 5.1 查看插件日志
1. **右键点击插件图标**
2. **选择"检查弹出内容"**
3. **会打开开发者工具**
4. **点击"Console"标签**
5. **查看是否有红色错误信息**

### 5.2 查看网页日志
1. **在微博页面按 F12**
2. **点击"Console"标签**
3. **查看是否有错误信息**

### 5.3 常见问题解决

#### 问题1：插件图标不显示
**解决方法**：
1. 检查是否正确选择了 `build/chrome-mv3-dev` 文件夹
2. 确保开发服务器还在运行（命令行窗口没关闭）
3. 尝试刷新扩展程序页面

#### 问题2：点击图标没反应
**解决方法**：
1. 右键点击图标，选择"检查弹出内容"
2. 查看 Console 中的错误信息
3. 如果有红色错误，请截图求助

#### 问题3：在微博页面没效果
**解决方法**：
1. 确保已经登录微博账号
2. 检查微博链接格式是否正确
3. 在微博页面按 F12，查看 Console 错误

## 📱 第六步：完整测试流程

### 6.1 准备测试环境
1. **登录微博账号**
   - 在浏览器中访问 https://weibo.com
   - 登录你的微博账号

2. **准备测试链接**
   - 找一条有评论的微博
   - 复制微博链接

### 6.2 执行测试
1. **打开插件界面**
2. **设置参数**：
   - 关键词：输入要搜索的词
   - 最大点赞数：建议设置为 1（测试用）
   - 点赞间隔：建议设置为 3000（3秒）
3. **输入微博链接**
4. **点击"开始执行"**
5. **观察执行过程**

### 6.3 验证结果
1. **查看执行日志**
2. **检查微博页面是否有点赞动作**
3. **确认功能正常工作**

## 🔧 常见问题和解决方案

### 问题1: 复制的是emoji图片链接而不是微博链接

**现象**: 点击复制按钮后，复制的链接是类似 `https://h5.sinaimg.cn/upload/2015/09/25/3/timeline_card_small_web_default.png` 的图片链接，而不是微博链接。

**原因**: 这是因为页面中同时存在多个链接，插件需要智能选择最合适的链接。

**解决方案**:
1. **已修复**: 最新版本已经优化了链接选择逻辑，会优先选择微博链接
2. **立即验证修复**:

#### 🔧 详细调试步骤

**第1步: 确保插件已更新**
```bash
# 1. 确保开发服务器在运行
pnpm run dev

# 2. 看到绿色 "DONE" 表示更新成功
```

**第2步: 重新加载插件**
1. 打开 Chrome 扩展管理页面: `chrome://extensions/`
2. 找到"微博控评助手"插件
3. 点击刷新按钮 🔄
4. 确保状态显示"已启用"

**第3步: 调试链接选择**
1. **打开微博聊天页面** (必须包含 `api.weibo.com/chat`)
2. **按 F12 打开开发者工具**
3. **点击 Console 标签**
4. **复制粘贴以下调试代码**:

```javascript
// 复制这段代码到浏览器控制台运行
fetch('/debug-link-copy.js').then(r=>r.text()).then(eval)
```

或者手动运行调试:

```javascript
// 检查插件是否加载
console.log('复制按钮数量:', document.querySelectorAll('.weibo-chat-copy-btn').length);

// 检查页面URL
console.log('当前页面:', window.location.href);

// 查找网页链接文本
const linkElements = Array.from(document.querySelectorAll('*')).filter(el =>
  el.textContent && el.textContent.includes('网页链接')
);
console.log('找到网页链接元素:', linkElements.length);

// 分析第一个复制按钮
const firstButton = document.querySelector('.weibo-chat-copy-btn');
if (firstButton) {
  console.log('第一个按钮的链接:', firstButton.title);
} else {
  console.log('❌ 没有找到复制按钮');
}
```

**第4步: 查看调试信息**
在控制台中查找以下关键日志:
- ✅ `Found weibo URLs:` - 表示找到了微博链接
- ✅ `Selected best URL:` - 显示最终选择的链接
- ❌ `Only image URLs found` - 表示只找到了图片链接

**第5步: 测试复制功能**
1. 点击复制按钮
2. 粘贴到记事本查看复制的链接
3. 确认是微博链接而不是图片链接

#### 🚨 如果问题仍然存在

**立即解决方案**:

1. **重新加载插件** (最重要!)
   ```
   1. 打开 chrome://extensions/
   2. 找到"微博控评助手"
   3. 点击刷新按钮 🔄
   4. 确保状态为"已启用"
   ```

2. **检查页面兼容性**
   - ✅ 支持的页面: `weibo.com`, `m.weibo.cn`, `api.weibo.com/chat`
   - ❌ 不支持: 其他网站

3. **强制重新处理**
   在浏览器控制台运行:
   ```javascript
   // 强制重新处理页面上的链接
   if (window.linkCopyManager) {
     window.linkCopyManager.processExistingMessages();
   }
   ```

4. **手动测试链接选择**
   在浏览器控制台运行:
   ```javascript
   // 测试你的具体链接
   const testUrls = [
     'https://h5.sinaimg.cn/upload/2015/09/25/3/timeline_card_small_web_default.png',
     'https://weibo.com/2323589097/5176488632521341?ua=Mozilla%2F5.0%20%28Macintosh%3B%20Intel%20Mac%20OS%20X%2010_15_7%29%20AppleWebKit%2F537.36%20%28KHTML,%20like%20Gecko%29%20Chrome%2F137.0.0.0%20Safari%2F537.36'
   ];

   // 应该选择微博链接
   const weiboUrls = testUrls.filter(url =>
     url.includes('weibo.com') && !url.includes('sinaimg.cn')
   );
   console.log('应该选择:', weiboUrls[0]);
   ```

5. **完全重启**
   如果以上都不行:
   ```
   1. 关闭所有微博页面
   2. 停止开发服务器 (Ctrl+C)
   3. 重新启动: pnpm run dev
   4. 重新加载插件
   5. 重新打开微博页面
   ```

### 问题2: 插件在某些页面不工作

**现象**: 在微博聊天页面看不到复制按钮

**解决方案**:
1. 检查页面URL是否包含 `api.weibo.com/chat`
2. 确保页面中有"网页链接"文本
3. 查看浏览器控制台是否有错误信息

## 🆘 遇到问题怎么办

### 立即求助的情况
- 命令行出现红色错误信息
- 插件无法加载
- 浏览器崩溃
- 复制功能不正常
- 任何你不理解的错误

### 求助时请提供
1. **错误截图**（包括完整的错误信息）
2. **你的操作系统**（Windows 10/11 或 Mac）
3. **Chrome 浏览器版本**
4. **你正在执行的步骤**
5. **复制的实际链接**（如果是链接问题）
6. **浏览器控制台的错误信息**

### 获取帮助的方式
1. **截图保存错误信息**
2. **详细描述你的操作步骤**
3. **说明问题出现的时机**
4. **提供测试用的微博链接**

## ✅ 成功标志

当你看到以下情况，说明一切正常：
- ✅ 命令行显示绿色 "DONE" 信息
- ✅ Chrome 扩展页面显示插件已启用
- ✅ 点击插件图标能弹出界面
- ✅ 在微博页面能看到自动点赞动作
- ✅ 插件日志显示正常执行信息

## 🎉 恭喜！

如果你完成了所有步骤，恭喜你已经成功启动和调试了这个微博控评插件！

记住：
- 保持命令行窗口开启
- 遇到问题及时求助
- 小心使用，遵守平台规则

---

💡 **小贴士**：这个指南会根据你的反馈不断完善，如果有任何不清楚的地方，请随时提问！
